import React, { useState, useEffect } from 'react';
import { fetchReport01, formatarDataParaAPI } from '../services/api55pbx';

function Dashboard() {
  const [dados, setDados] = useState(null);
  const [erro, setErro] = useState(null);
  const [carregando, setCarregando] = useState(false);

  useEffect(() => {
    async function carregarDados() {
      setCarregando(true);
      setErro(null);

      const dataFim = new Date();
      const dataInicio = new Date();
      dataInicio.setMonth(dataInicio.getMonth() - 3);

      try {
        const res = await fetchReport01(formatarDataParaAPI(dataInicio), formatarDataParaAPI(dataFim));
        setDados(res.dados || res);
      } catch (e) {
        setErro(e.message || 'Erro desconhecido');
      }

      setCarregando(false);
    }

    carregarDados();
  }, []);

  if (carregando) return <div>Carregando dados...</div>;
  if (erro) return <div>Erro: {erro}</div>;
  if (!dados) return <div>Nenhum dado dispon√≠vel</div>;

  return (
    <div>
      <h2>Dashboard</h2>
      <pre>{JSON.stringify(dados, null, 2)}</pre>
    </div>
  );
}

export default Dashboard;

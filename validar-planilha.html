<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validador de Planilha VeloIGP</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .validation-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .success { 
            background: rgba(76, 175, 80, 0.2);
            border-left: 5px solid #4CAF50;
        }
        .error { 
            background: rgba(244, 67, 54, 0.2);
            border-left: 5px solid #f44336;
        }
        .warning { 
            background: rgba(255, 152, 0, 0.2);
            border-left: 5px solid #ff9800;
        }
        .info { 
            background: rgba(33, 150, 243, 0.2);
            border-left: 5px solid #2196F3;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
        }
        .data-preview {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.1);
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid rgba(255,255,255,0.2);
        }
        th {
            background: rgba(255,255,255,0.2);
            font-weight: bold;
        }
        .status-icon {
            font-size: 1.2em;
            margin-right: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Validador de Planilha VeloIGP</h1>
            <p>Verifique se sua planilha est√° pronta para o sistema</p>
        </div>

        <div class="validation-section info">
            <h3>üìã Informa√ß√µes da Valida√ß√£o</h3>
            <p><strong>ID da Planilha:</strong> 1Ksc8TwB6FG_Vn-xLbxMMOHqh61Vu60Jp</p>
            <p><strong>API Key:</strong> AIzaSyA-BgGFBY8BTfwqkKlAB92ZM-jvMexmM_A</p>
            <p><strong>Status:</strong> <span id="overall-status">Aguardando valida√ß√£o...</span></p>
        </div>

        <div class="validation-section">
            <h3>üîß Valida√ß√µes</h3>
            <button onclick="startValidation()" id="validate-btn">Iniciar Valida√ß√£o</button>
            <button onclick="clearResults()" id="clear-btn">Limpar Resultados</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
        </div>

        <div id="validation-results"></div>

        <div class="validation-section">
            <h3>üìä Estrutura Esperada</h3>
            <p>A planilha deve ter <strong>exatamente 40 colunas</strong> com estes cabe√ßalhos:</p>
            <div class="data-preview">
                <table>
                    <tr>
                        <th>Coluna</th>
                        <th>Cabe√ßalho Esperado</th>
                        <th>Status</th>
                    </tr>
                    <tr><td>A</td><td>Chamada</td><td id="col-A">‚è≥</td></tr>
                    <tr><td>B</td><td>Audio E Transcri√ß√µes</td><td id="col-B">‚è≥</td></tr>
                    <tr><td>C</td><td>Operador</td><td id="col-C">‚è≥</td></tr>
                    <tr><td>D</td><td>Data</td><td id="col-D">‚è≥</td></tr>
                    <tr><td>E</td><td>Hora</td><td id="col-E">‚è≥</td></tr>
                    <tr><td>F</td><td>Data Atendimento</td><td id="col-F">‚è≥</td></tr>
                    <tr><td>G</td><td>Hora Atendimento</td><td id="col-G">‚è≥</td></tr>
                    <tr><td>H</td><td>Pa√≠s</td><td id="col-H">‚è≥</td></tr>
                    <tr><td>I</td><td>DDD</td><td id="col-I">‚è≥</td></tr>
                    <tr><td>J</td><td>Numero</td><td id="col-J">‚è≥</td></tr>
                    <tr><td>K</td><td>Fila</td><td id="col-K">‚è≥</td></tr>
                    <tr><td>L</td><td>Tempo Na Ura</td><td id="col-L">‚è≥</td></tr>
                    <tr><td>M</td><td>Tempo De Espera</td><td id="col-M">‚è≥</td></tr>
                    <tr><td>N</td><td>Tempo Falado</td><td id="col-N">‚è≥</td></tr>
                    <tr><td>O</td><td>Tempo Total</td><td id="col-O">‚è≥</td></tr>
                    <tr><td>P</td><td>Desconex√£o</td><td id="col-P">‚è≥</td></tr>
                    <tr><td>Q</td><td>Telefone Entrada</td><td id="col-Q">‚è≥</td></tr>
                    <tr><td>R</td><td>Caminho U R A</td><td id="col-R">‚è≥</td></tr>
                    <tr><td>S</td><td>Cpf/Cnpj</td><td id="col-S">‚è≥</td></tr>
                    <tr><td>T</td><td>Pedido</td><td id="col-T">‚è≥</td></tr>
                    <tr><td>U</td><td>Id Liga√ß√£o</td><td id="col-U">‚è≥</td></tr>
                    <tr><td>V</td><td>Id Liga√ß√£o De Origem</td><td id="col-V">‚è≥</td></tr>
                    <tr><td>W</td><td>I D Do Ticket</td><td id="col-W">‚è≥</td></tr>
                    <tr><td>X</td><td>Fluxo De Filas</td><td id="col-X">‚è≥</td></tr>
                    <tr><td>Y</td><td>Wh_quality_reason</td><td id="col-Y">‚è≥</td></tr>
                    <tr><td>Z</td><td>Wh_humor_reason</td><td id="col-Z">‚è≥</td></tr>
                    <tr><td>AA</td><td>Question√°rio De Qualidade</td><td id="col-AA">‚è≥</td></tr>
                    <tr><td>AB</td><td>Pergunta2 1 PERGUNTA ATENDENTE</td><td id="col-AB">‚è≥</td></tr>
                    <tr><td>AC</td><td>Pergunta2 2 PERGUNTA SOLUCAO</td><td id="col-AC">‚è≥</td></tr>
                    <tr><td>AD</td><td>Dia</td><td id="col-AD">‚è≥</td></tr>
                    <tr><td>AE</td><td>qtde</td><td id="col-AE">‚è≥</td></tr>
                    <tr><td>AF</td><td>At√© 20 Seg</td><td id="col-AF">‚è≥</td></tr>
                    <tr><td>AG</td><td>Faixa</td><td id="col-AG">‚è≥</td></tr>
                    <tr><td>AH</td><td>M√™s</td><td id="col-AH">‚è≥</td></tr>
                    <tr><td>AI</td><td>TMA (FALADO</td><td id="col-AI">‚è≥</td></tr>
                    <tr><td>AJ</td><td>Tempo URA (seg</td><td id="col-AJ">‚è≥</td></tr>
                    <tr><td>AK</td><td>TME (seg)</td><td id="col-AK">‚è≥</td></tr>
                    <tr><td>AL</td><td>TMA (seg)</td><td id="col-AL">‚è≥</td></tr>
                    <tr><td>AM</td><td>Pergunta 1</td><td id="col-AM">‚è≥</td></tr>
                    <tr><td>AN</td><td>Pergunta 2</td><td id="col-AN">‚è≥</td></tr>
                </table>
            </div>
        </div>

        <div class="validation-section">
            <h3>üìà Preview dos Dados</h3>
            <div id="data-preview"></div>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = '1Ksc8TwB6FG_Vn-xLbxMMOHqh61Vu60Jp';
        const API_KEY = 'AIzaSyA-BgGFBY8BTfwqkKlAB92ZM-jvMexmM_A';
        
        const EXPECTED_HEADERS = [
            'Chamada', 'Audio E Transcri√ß√µes', 'Operador', 'Data', 'Hora', 'Data Atendimento', 'Hora Atendimento',
            'Pa√≠s', 'DDD', 'Numero', 'Fila', 'Tempo Na Ura', 'Tempo De Espera', 'Tempo Falado', 'Tempo Total',
            'Desconex√£o', 'Telefone Entrada', 'Caminho U R A', 'Cpf/Cnpj', 'Pedido', 'Id Liga√ß√£o', 'Id Liga√ß√£o De Origem',
            'I D Do Ticket', 'Fluxo De Filas', 'Wh_quality_reason', 'Wh_humor_reason', 'Question√°rio De Qualidade',
            'Pergunta2 1 PERGUNTA ATENDENTE', 'Pergunta2 2 PERGUNTA SOLUCAO', 'Dia', 'qtde', 'At√© 20 Seg', 'Faixa',
            'M√™s', 'TMA (FALADO', 'Tempo URA (seg', 'TME (seg)', 'TMA (seg)', 'Pergunta 1', 'Pergunta 2'
        ];

        let validationResults = {
            accessible: false,
            hasData: false,
            correctStructure: false,
            correctHeaders: false,
            totalRows: 0,
            totalCols: 0,
            errors: []
        };

        async function startValidation() {
            const btn = document.getElementById('validate-btn');
            const progress = document.getElementById('progress');
            const status = document.getElementById('overall-status');
            
            btn.disabled = true;
            btn.textContent = 'Validando...';
            status.textContent = 'Validando...';
            
            try {
                // Reset progress
                progress.style.width = '0%';
                
                // Test 1: Accessibility
                addResult('üîç Testando acesso √† planilha...', 'info');
                progress.style.width = '20%';
                
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`);
                if (response.ok) {
                    validationResults.accessible = true;
                    addResult('‚úÖ Planilha acess√≠vel via API', 'success');
                } else {
                    const error = await response.text();
                    validationResults.errors.push(`Erro de acesso: ${response.status} - ${error}`);
                    addResult(`‚ùå Erro de acesso: ${response.status}`, 'error');
                    return;
                }
                
                // Test 2: Data retrieval
                addResult('üìä Obtendo dados da planilha...', 'info');
                progress.style.width = '40%';
                
                const dataResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/A:AN?key=${API_KEY}`);
                if (!dataResponse.ok) {
                    const error = await dataResponse.text();
                    validationResults.errors.push(`Erro ao obter dados: ${dataResponse.status} - ${error}`);
                    addResult(`‚ùå Erro ao obter dados: ${dataResponse.status}`, 'error');
                    return;
                }
                
                const data = await dataResponse.json();
                const values = data.values || [];
                
                if (values.length === 0) {
                    validationResults.errors.push('Planilha vazia');
                    addResult('‚ùå Planilha vazia', 'error');
                    return;
                }
                
                validationResults.hasData = true;
                validationResults.totalRows = values.length;
                validationResults.totalCols = values[0].length;
                
                addResult(`‚úÖ Dados obtidos: ${values.length} linhas, ${values[0].length} colunas`, 'success');
                
                // Test 3: Structure validation
                addResult('üîß Validando estrutura...', 'info');
                progress.style.width = '60%';
                
                if (values[0].length === 40) {
                    validationResults.correctStructure = true;
                    addResult('‚úÖ Estrutura correta (40 colunas)', 'success');
                } else {
                    validationResults.errors.push(`Estrutura incorreta: esperado 40 colunas, encontrado ${values[0].length}`);
                    addResult(`‚ùå Estrutura incorreta: ${values[0].length} colunas (esperado 40)`, 'error');
                }
                
                // Test 4: Headers validation
                addResult('üìã Validando cabe√ßalhos...', 'info');
                progress.style.width = '80%';
                
                const headers = values[0];
                let correctHeaders = 0;
                
                for (let i = 0; i < Math.min(headers.length, EXPECTED_HEADERS.length); i++) {
                    const expected = EXPECTED_HEADERS[i];
                    const actual = headers[i];
                    const colLetter = String.fromCharCode(65 + i);
                    
                    if (actual === expected) {
                        document.getElementById(`col-${colLetter}`).textContent = '‚úÖ';
                        correctHeaders++;
                    } else {
                        document.getElementById(`col-${colLetter}`).textContent = '‚ùå';
                        validationResults.errors.push(`Coluna ${colLetter}: esperado "${expected}", encontrado "${actual}"`);
                    }
                }
                
                if (correctHeaders === 40) {
                    validationResults.correctHeaders = true;
                    addResult('‚úÖ Todos os cabe√ßalhos est√£o corretos', 'success');
                } else {
                    addResult(`‚ö†Ô∏è ${correctHeaders}/40 cabe√ßalhos corretos`, 'warning');
                }
                
                // Test 5: Data preview
                addResult('üìà Gerando preview dos dados...', 'info');
                progress.style.width = '100%';
                
                showDataPreview(values.slice(0, 5));
                
                // Final result
                const allGood = validationResults.accessible && validationResults.hasData && 
                               validationResults.correctStructure && validationResults.correctHeaders;
                
                if (allGood) {
                    status.textContent = '‚úÖ Valida√ß√£o conclu√≠da com sucesso!';
                    addResult('üéâ Planilha pronta para uso no VeloIGP!', 'success');
                } else {
                    status.textContent = '‚ö†Ô∏è Valida√ß√£o conclu√≠da com problemas';
                    addResult('‚ö†Ô∏è Planilha precisa de ajustes antes de usar no VeloIGP', 'warning');
                }
                
            } catch (error) {
                validationResults.errors.push(`Erro geral: ${error.message}`);
                addResult(`‚ùå Erro na valida√ß√£o: ${error.message}`, 'error');
                status.textContent = '‚ùå Erro na valida√ß√£o';
            } finally {
                btn.disabled = false;
                btn.textContent = 'Iniciar Valida√ß√£o';
            }
        }

        function addResult(message, type) {
            const resultsDiv = document.getElementById('validation-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<span class="status-icon">${getIcon(type)}</span>${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        function getIcon(type) {
            switch(type) {
                case 'success': return '‚úÖ';
                case 'error': return '‚ùå';
                case 'warning': return '‚ö†Ô∏è';
                case 'info': return '‚ÑπÔ∏è';
                default: return 'üìã';
            }
        }

        function showDataPreview(data) {
            const previewDiv = document.getElementById('data-preview');
            if (data.length === 0) {
                previewDiv.innerHTML = '<p>Nenhum dado para mostrar</p>';
                return;
            }

            let html = '<table><thead><tr>';
            for (let i = 0; i < data[0].length; i++) {
                const colLetter = String.fromCharCode(65 + i);
                html += `<th>${colLetter}</th>`;
            }
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                for (let i = 0; i < row.length; i++) {
                    html += `<td>${row[i] || ''}</td>`;
                }
                html += '</tr>';
            });

            html += '</tbody></table>';
            previewDiv.innerHTML = html;
        }

        function clearResults() {
            document.getElementById('validation-results').innerHTML = '';
            document.getElementById('data-preview').innerHTML = '';
            document.getElementById('overall-status').textContent = 'Aguardando valida√ß√£o...';
            document.getElementById('progress').style.width = '0%';
            
            // Reset column status
            for (let i = 0; i < 40; i++) {
                const colLetter = String.fromCharCode(65 + i);
                document.getElementById(`col-${colLetter}`).textContent = '‚è≥';
            }
            
            validationResults = {
                accessible: false,
                hasData: false,
                correctStructure: false,
                correctHeaders: false,
                totalRows: 0,
                totalCols: 0,
                errors: []
            };
        }
    </script>
</body>
</html>

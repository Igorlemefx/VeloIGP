<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Acesso √† Planilha</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Acesso √† Planilha VeloIGP</h1>
    
    <div class="test-section info">
        <h3>üìã Informa√ß√µes do Teste</h3>
        <p><strong>ID da Planilha:</strong> 1Ksc8TwB6FG_Vn-xLbxMMOHqh61Vu60Jp</p>
        <p><strong>API Key:</strong> AIzaSyA-BgGFBY8BTfwqkKlAB92ZM-jvMexmM_A</p>
        <p><strong>Status:</strong> <span id="status">Testando...</span></p>
    </div>

    <div class="test-section">
        <h3>üîç Teste 1: Informa√ß√µes da Planilha</h3>
        <button onclick="testSpreadsheetInfo()">Executar Teste</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h3>üìä Teste 2: Dados da Planilha</h3>
        <button onclick="testSpreadsheetData()">Executar Teste</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h3>üìà Resultado Final</h3>
        <div id="final-result"></div>
    </div>

    <script>
        const SPREADSHEET_ID = '1Ksc8TwB6FG_Vn-xLbxMMOHqh61Vu60Jp';
        const API_KEY = 'AIzaSyA-BgGFBY8BTfwqkKlAB92ZM-jvMexmM_A';
        
        let test1Success = false;
        let test2Success = false;

        async function testSpreadsheetInfo() {
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<p>üîÑ Testando acesso √†s informa√ß√µes da planilha...</p>';
            
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`);
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>‚úÖ Sucesso!</h4>
                            <p><strong>T√≠tulo:</strong> ${data.properties?.title || 'N/A'}</p>
                            <p><strong>√öltima modifica√ß√£o:</strong> ${data.properties?.modifiedTime || 'N/A'}</p>
                            <p><strong>N√∫mero de abas:</strong> ${data.sheets?.length || 0}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                    test1Success = true;
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>‚ùå Erro ${response.status}</h4>
                            <p><strong>Mensagem:</strong> ${errorText}</p>
                        </div>
                    `;
                    test1Success = false;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Erro de Rede</h4>
                        <p><strong>Mensagem:</strong> ${error.message}</p>
                    </div>
                `;
                test1Success = false;
            }
            
            updateFinalResult();
        }

        async function testSpreadsheetData() {
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<p>üîÑ Testando acesso aos dados da planilha...</p>';
            
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/A:AN?key=${API_KEY}`);
                
                if (response.ok) {
                    const data = await response.json();
                    const values = data.values || [];
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>‚úÖ Sucesso!</h4>
                            <p><strong>Linhas obtidas:</strong> ${values.length}</p>
                            <p><strong>Colunas na primeira linha:</strong> ${values[0]?.length || 0}</p>
                            <p><strong>Primeiras 3 linhas:</strong></p>
                            <pre>${JSON.stringify(values.slice(0, 3), null, 2)}</pre>
                        </div>
                    `;
                    test2Success = true;
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>‚ùå Erro ${response.status}</h4>
                            <p><strong>Mensagem:</strong> ${errorText}</p>
                        </div>
                    `;
                    test2Success = false;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Erro de Rede</h4>
                        <p><strong>Mensagem:</strong> ${error.message}</p>
                    </div>
                `;
                test2Success = false;
            }
            
            updateFinalResult();
        }

        function updateFinalResult() {
            const resultDiv = document.getElementById('final-result');
            const statusDiv = document.getElementById('status');
            
            if (test1Success && test2Success) {
                resultDiv.innerHTML = `
                    <div class="success">
                        <h4>üéâ Todos os testes passaram!</h4>
                        <p>A planilha est√° acess√≠vel e o sistema VeloIGP deve funcionar corretamente.</p>
                        <p><strong>Pr√≥ximos passos:</strong></p>
                        <ul>
                            <li>Acesse o sistema VeloIGP</li>
                            <li>V√° para a p√°gina "Planilhas"</li>
                            <li>Verifique se os dados aparecem corretamente</li>
                        </ul>
                    </div>
                `;
                statusDiv.textContent = '‚úÖ Funcionando';
                statusDiv.style.color = 'green';
            } else if (test1Success || test2Success) {
                resultDiv.innerHTML = `
                    <div class="info">
                        <h4>‚ö†Ô∏è Teste parcial</h4>
                        <p>Alguns testes passaram, mas pode haver problemas de configura√ß√£o.</p>
                        <p><strong>Teste 1 (Informa√ß√µes):</strong> ${test1Success ? '‚úÖ' : '‚ùå'}</p>
                        <p><strong>Teste 2 (Dados):</strong> ${test2Success ? '‚úÖ' : '‚ùå'}</p>
                    </div>
                `;
                statusDiv.textContent = '‚ö†Ô∏è Parcial';
                statusDiv.style.color = 'orange';
            } else {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Todos os testes falharam</h4>
                        <p>A planilha n√£o est√° acess√≠vel. Verifique:</p>
                        <ul>
                            <li>Se a planilha est√° p√∫blica</li>
                            <li>Se a API key est√° correta</li>
                            <li>Se o Google Sheets API est√° habilitado</li>
                        </ul>
                    </div>
                `;
                statusDiv.textContent = '‚ùå Erro';
                statusDiv.style.color = 'red';
            }
        }

        // Executar testes automaticamente ao carregar a p√°gina
        window.onload = function() {
            testSpreadsheetInfo();
            setTimeout(testSpreadsheetData, 1000);
        };
    </script>
</body>
</html>
